<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M Sesi Artik√ºlasyon √áalƒ±≈ümasƒ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }

        .container {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            max-width: 700px;
            width: 90%;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .title {
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .word-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        }

        .word-image {
            width: 200px;
            height: 200px;
            border-radius: 15px;
            margin: 0 auto 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 8em;
            object-fit: cover;
        }

        .word-text {
            font-size: 3.5em;
            margin: 20px 0;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            font-weight: bold;
        }

        .word-position {
            font-size: 1.3em;
            color: #ffeb3b;
            margin-bottom: 15px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
        }

        .controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            font-size: 1.2em;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .listen-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .record-btn {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
        }

        .correct-btn {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
        }

        .wrong-btn {
            background: linear-gradient(45deg, #f44336, #d32f2f);
            color: white;
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .progress {
            margin: 30px 0;
        }

        .progress-text {
            font-size: 1.2em;
            margin-bottom: 15px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #4CAF50, #45a049);
            width: 0%;
            transition: width 0.5s ease;
            border-radius: 10px;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            flex-wrap: wrap;
            gap: 20px;
        }

        .stat-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            flex: 1;
            min-width: 120px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 0.9em;
            opacity: 0.8;
        }

        .recording-indicator {
            display: none;
            color: #ff4444;
            font-size: 1.1em;
            margin: 10px 0;
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .feedback {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .feedback.show {
            opacity: 1;
        }

        .feedback.correct {
            background: rgba(76, 175, 80, 0.3);
            color: #4CAF50;
            border: 2px solid #4CAF50;
        }

        .feedback.wrong {
            background: rgba(244, 67, 54, 0.3);
            color: #f44336;
            border: 2px solid #f44336;
        }

        .completion {
            display: none;
            text-align: center;
            padding: 30px;
            background: rgba(76, 175, 80, 0.2);
            border-radius: 15px;
            border: 2px solid #4CAF50;
            margin: 20px 0;
        }

        .completion h2 {
            color: #4CAF50;
            margin-bottom: 15px;
            font-size: 2em;
        }

        .start-screen {
            text-align: center;
            padding: 30px;
        }

        .start-screen h2 {
            font-size: 2em;
            margin-bottom: 20px;
            color: #ffeb3b;
        }

        .start-btn {
            background: linear-gradient(45deg, #ff6b6b, #ff5252);
            color: white;
            font-size: 1.3em;
            padding: 20px 40px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .title {
                font-size: 2em;
            }
            
            .word-image {
                width: 150px;
                height: 150px;
                font-size: 6em;
            }
            
            .word-text {
                font-size: 2.5em;
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
            
            button {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="title">üéØ M Sesi √áalƒ±≈ümasƒ±</h1>
        
        <div class="start-screen" id="startScreen">
            <h2>M Sesini √ñƒürenmeye Hazƒ±r Mƒ±sƒ±n?</h2>
            <p style="font-size: 1.2em; margin: 20px 0; opacity: 0.9;">
                Bu uygulamada M sesinin kelime ba≈üƒ±nda, ortasƒ±nda ve sonunda yer aldƒ±ƒüƒ± √∂rnekleri √ßalƒ±≈üacaƒüƒ±z!
            </p>
            <button class="start-btn" onclick="startApp()">üöÄ Ba≈üla!</button>
        </div>
        
        <div class="word-card" id="wordCard" style="display: none;">
            <div class="word-position" id="wordPosition"></div>
            <div class="word-image" id="wordImage">üçå</div>
            <div class="word-text" id="wordText">muz</div>
        </div>
        
        <div class="controls" id="controls" style="display: none;">
            <button class="listen-btn" id="listenBtn">üîä Dinle</button>
            <button class="record-btn" id="recordBtn">üé§ Kaydet</button>
        </div>
        
        <div class="recording-indicator" id="recordingIndicator">
            üî¥ Kaydediliyor... M sesini s√∂yle!
        </div>
        
        <div class="feedback" id="feedback"></div>
        
        <div class="controls" id="manualControls" style="display: none;">
            <button class="correct-btn" id="correctBtn">‚úÖ Doƒüru</button>
            <button class="wrong-btn" id="wrongBtn">‚ùå Yanlƒ±≈ü</button>
        </div>
        
        <div class="progress" id="progressSection" style="display: none;">
            <div class="progress-text">ƒ∞lerleme: <span id="currentWord">0</span> / 15</div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>
        
        <div class="stats" id="statsSection" style="display: none;">
            <div class="stat-item">
                <span class="stat-number" id="correctCount">0</span>
                <span class="stat-label">Doƒüru</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="wrongCount">0</span>
                <span class="stat-label">Yanlƒ±≈ü</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="accuracy">0%</span>
                <span class="stat-label">Ba≈üarƒ±</span>
            </div>
        </div>
        
        <div class="completion" id="completion">
            <h2>üéâ Tebrikler!</h2>
            <p>M sesi √ßalƒ±≈ümasƒ±nƒ± tamamladƒ±n!</p>
            <button onclick="restartApp()" style="margin-top: 15px; background: linear-gradient(45deg, #667eea, #764ba2);">üîÑ Yeniden Ba≈üla</button>
        </div>
    </div>

    <script>
        // Kelime listeleri - emoji ile g√∂rselle≈ütirilmi≈ü
        const words = {
            beginning: [
                { word: 'mavi', emoji: 'üîµ', position: 'M sesi kelime ba≈üƒ±nda' },
                { word: 'masa', emoji: 'ü™ë', position: 'M sesi kelime ba≈üƒ±nda' },
                { word: 'muz', emoji: 'üçå', position: 'M sesi kelime ba≈üƒ±nda' },
                { word: 'makas', emoji: '‚úÇÔ∏è', position: 'M sesi kelime ba≈üƒ±nda' },
                { word: 'meyve', emoji: 'üçé', position: 'M sesi kelime ba≈üƒ±nda' }
            ],
            middle: [
                { word: 'keman', emoji: 'üéª', position: 'M sesi kelime ortasƒ±nda' },
                { word: 'zaman', emoji: '‚è∞', position: 'M sesi kelime ortasƒ±nda' },
                { word: 'domates', emoji: 'üçÖ', position: 'M sesi kelime ortasƒ±nda' },
                { word: 'telefon', emoji: 'üìû', position: 'M sesi kelime ortasƒ±nda' },
                { word: 'armut', emoji: 'üçê', position: 'M sesi kelime ortasƒ±nda' }
            ],
            end: [
                { word: 'cam', emoji: 'ü™ü', position: 'M sesi kelime sonunda' },
                { word: 'yem', emoji: 'üêü', position: 'M sesi kelime sonunda' },
                { word: 'gam', emoji: 'üéµ', position: 'M sesi kelime sonunda' },
                { word: 'hem', emoji: '‚ûï', position: 'M sesi kelime sonunda' },
                { word: '≈üam', emoji: 'üåÜ', position: 'M sesi kelime sonunda' }
            ]
        };
        
        let currentCategory = 'beginning';
        let currentWordIndex = 0;
        let correctAnswers = 0;
        let wrongAnswers = 0;
        let totalWords = 15;
        let currentWordNumber = 0;
        let mediaRecorder;
        let audioChunks = [];
        let isRecording = false;
        let gameStarted = false;
        
        // DOM elementleri
        const startScreen = document.getElementById('startScreen');
        const wordCard = document.getElementById('wordCard');
        const wordImage = document.getElementById('wordImage');
        const wordText = document.getElementById('wordText');
        const wordPosition = document.getElementById('wordPosition');
        const listenBtn = document.getElementById('listenBtn');
        const recordBtn = document.getElementById('recordBtn');
        const feedback = document.getElementById('feedback');
        const progressFill = document.getElementById('progressFill');
        const currentWordSpan = document.getElementById('currentWord');
        const correctCount = document.getElementById('correctCount');
        const wrongCount = document.getElementById('wrongCount');
        const accuracy = document.getElementById('accuracy');
        const completion = document.getElementById('completion');
        const recordingIndicator = document.getElementById('recordingIndicator');
        const manualControls = document.getElementById('manualControls');
        const correctBtn = document.getElementById('correctBtn');
        const wrongBtn = document.getElementById('wrongBtn');
        const controls = document.getElementById('controls');
        const progressSection = document.getElementById('progressSection');
        const statsSection = document.getElementById('statsSection');
        
        // Ses sentezi i√ßin
        const synth = window.speechSynthesis;
        
        function getCurrentWordData() {
            const categoryWords = words[currentCategory];
            return categoryWords[currentWordIndex];
        }
        
        function speakWord(word) {
            if (synth.speaking) {
                synth.cancel();
            }
            
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = 'tr-TR';
            utterance.rate = 0.7;
            utterance.pitch = 1.1;
            utterance.volume = 0.8;
            
            synth.speak(utterance);
        }
        
        function displayNewWord() {
            const wordData = getCurrentWordData();
            wordText.textContent = wordData.word;
            wordImage.textContent = wordData.emoji;
            wordPosition.textContent = wordData.position;
            
            // Otomatik olarak kelimeyi seslendir
            setTimeout(() => {
                speakWord(wordData.word);
            }, 500);
        }
        
        function nextWord() {
            currentWordIndex++;
            currentWordNumber++;
            
            // Kategori deƒüi≈ütirme kontrol√º
            if (currentCategory === 'beginning' && currentWordIndex >= words.beginning.length) {
                currentCategory = 'middle';
                currentWordIndex = 0;
            } else if (currentCategory === 'middle' && currentWordIndex >= words.middle.length) {
                currentCategory = 'end';
                currentWordIndex = 0;
            }
            
            updateProgress();
            
            if (currentWordNumber >= totalWords) {
                showCompletion();
                return;
            }
            
            // Yeni kelimeyi g√∂ster ve seslendir
            setTimeout(() => {
                displayNewWord();
            }, 1000);
        }
        
        function updateProgress() {
            const progressPercent = (currentWordNumber / totalWords) * 100;
            progressFill.style.width = progressPercent + '%';
            currentWordSpan.textContent = currentWordNumber;
            
            correctCount.textContent = correctAnswers;
            wrongCount.textContent = wrongAnswers;
            
            const totalAttempts = correctAnswers + wrongAnswers;
            const accuracyPercent = totalAttempts > 0 ? Math.round((correctAnswers / totalAttempts) * 100) : 0;
            accuracy.textContent = accuracyPercent + '%';
        }
        
        function showFeedback(isCorrect) {
            feedback.textContent = isCorrect ? '‚úÖ Harika! Doƒüru s√∂yledin!' : '‚ùå Tekrar deneyelim!';
            feedback.className = 'feedback show ' + (isCorrect ? 'correct' : 'wrong');
            
            setTimeout(() => {
                feedback.className = 'feedback';
            }, 2000);
        }
        
        function showCompletion() {
            completion.style.display = 'block';
            wordCard.style.display = 'none';
            controls.style.display = 'none';
            manualControls.style.display = 'none';
        }
        
        function restartApp() {
            currentCategory = 'beginning';
            currentWordIndex = 0;
            correctAnswers = 0;
            wrongAnswers = 0;
            currentWordNumber = 0;
            gameStarted = false;
            
            completion.style.display = 'none';
            wordCard.style.display = 'none';
            controls.style.display = 'none';
            manualControls.style.display = 'none';
            progressSection.style.display = 'none';
            statsSection.style.display = 'none';
            startScreen.style.display = 'block';
            
            updateProgress();
        }
        
        async function startApp() {
            if (!gameStarted) {
                gameStarted = true;
                startScreen.style.display = 'none';
                wordCard.style.display = 'block';
                controls.style.display = 'flex';
                progressSection.style.display = 'block';
                statsSection.style.display = 'flex';
                
                // Mikrofon iznini ba≈ülangƒ±√ßta iste
                await requestMicrophonePermission();
                
                updateProgress();
                displayNewWord();
            }
        }
        
        // Mikrofon izni isteme fonksiyonu
        async function requestMicrophonePermission() {
            try {
                // Kullanƒ±cƒ±ya mikrofon izni gerektiƒüini bildiren alert
                const userWantsToUseMic = confirm(
                    "üé§ Mikrofon ƒ∞zni Gerekli\n\n" +
                    "Bu uygulama sesinizi kaydederek M sesi telaffuzunuzu deƒüerlendirebilir.\n\n" +
                    "Mikrofon iznini vermek ister misiniz?\n\n" +
                    "‚ùå Hayƒ±r derseniz manuel deƒüerlendirme butonlarƒ± kullanƒ±lacak."
                );
                
                if (userWantsToUseMic) {
                    console.log('Mikrofon izni isteniyor...');
                    const stream = await navigator.mediaDevices.getUserMedia({ 
                        audio: {
                            echoCancellation: true,
                            noiseSuppression: true,
                            sampleRate: 44100
                        } 
                    });
                    
                    // ƒ∞zin alƒ±ndƒ±ysa MediaRecorder'ƒ± ba≈ülat
                    mediaRecorder = new MediaRecorder(stream, {
                        mimeType: 'audio/webm;codecs=opus'
                    });
                    
                    mediaRecorder.ondataavailable = (event) => {
                        if (event.data.size > 0) {
                            audioChunks.push(event.data);
                        }
                    };
                    
                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
                        audioChunks = [];
                        analyzeAudio(audioBlob);
                    };
                    
                    console.log('Mikrofon izni ba≈üarƒ±yla alƒ±ndƒ±!');
                    
                    // Ba≈üarƒ±lƒ± mesajƒ± g√∂ster
                    showTempMessage('‚úÖ Mikrofon hazƒ±r! Artƒ±k sesli kayƒ±t yapabilirsiniz.', 'success');
                    
                } else {
                    // Kullanƒ±cƒ± mikrofon iznini reddetti
                    console.log('Kullanƒ±cƒ± mikrofon iznini reddetti.');
                    showManualControls();
                }
                
            } catch (error) {
                console.error('Mikrofon izni alƒ±namadƒ±:', error);
                
                let errorMessage = '‚ùå Mikrofon eri≈üimi saƒülanamadƒ±.\n\n';
                
                if (error.name === 'NotAllowedError') {
                    errorMessage += 'Mikrofon izni reddedildi. Manuel deƒüerlendirme butonlarƒ± kullanƒ±lacak.\n\n' +
                                  'üí° ƒ∞pucu: Tarayƒ±cƒ± ayarlarƒ±ndan mikrofon iznini a√ßabilirsiniz.';
                } else if (error.name === 'NotFoundError') {
                    errorMessage += 'Mikrofon bulunamadƒ±. Manuel deƒüerlendirme butonlarƒ± kullanƒ±lacak.';
                } else {
                    errorMessage += 'Teknik bir sorun olu≈ütu. Manuel deƒüerlendirme butonlarƒ± kullanƒ±lacak.';
                }
                
                alert(errorMessage);
                showManualControls();
            }
        }
        
        // Manuel kontrolleri g√∂ster
        function showManualControls() {
            manualControls.style.display = 'flex';
            showTempMessage('üéØ Manuel deƒüerlendirme modu aktif. √áocuƒüun telaffuzunu dinledikten sonra doƒüru/yanlƒ±≈ü butonlarƒ±nƒ± kullanƒ±n.', 'info');
        }
        
        // Ge√ßici mesaj g√∂sterme
        function showTempMessage(message, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: ${type === 'success' ? 'rgba(76, 175, 80, 0.9)' : 
                            type === 'error' ? 'rgba(244, 67, 54, 0.9)' : 
                            'rgba(33, 150, 243, 0.9)'};
                color: white;
                padding: 15px 25px;
                border-radius: 10px;
                font-size: 1.1em;
                font-weight: bold;
                z-index: 1000;
                box-shadow: 0 5px 15px rgba(0,0,0,0.3);
                max-width: 90vw;
                text-align: center;
                border: 2px solid ${type === 'success' ? '#4CAF50' : 
                                  type === 'error' ? '#f44336' : '#2196F3'};
            `;
            messageDiv.textContent = message;
            
            document.body.appendChild(messageDiv);
            
            // 4 saniye sonra kaldƒ±r
            setTimeout(() => {
                if (document.body.contains(messageDiv)) {
                    document.body.removeChild(messageDiv);
                }
            }, 4000);
        }
        
        // Kayƒ±t durumunu kontrol et ve ba≈ülat
        function startRecording() {
            if (!mediaRecorder) {
                showTempMessage('‚ùå Mikrofon izni alƒ±nmamƒ±≈ü. L√ºtfen sayfayƒ± yenileyip tekrar deneyin.', 'error');
                return;
            }
            
            if (mediaRecorder.state === 'recording') {
                return; // Zaten kayƒ±t yapƒ±lƒ±yor
            }
            
            try {
                // Kaydƒ± ba≈ülat
                audioChunks = [];
                mediaRecorder.start();
                isRecording = true;
                recordBtn.disabled = true;
                recordBtn.textContent = '‚èπÔ∏è Kaydediliyor...';
                recordingIndicator.style.display = 'block';
                
                console.log('Ses kaydƒ± ba≈ülatƒ±ldƒ±');
                
                // 3 saniye sonra otomatik durdur
                setTimeout(() => {
                    if (mediaRecorder && mediaRecorder.state === 'recording') {
                        mediaRecorder.stop();
                        isRecording = false;
                        console.log('Ses kaydƒ± durduruldu');
                    }
                }, 3000);
                
            } catch (error) {
                console.error('Kayƒ±t ba≈ülatƒ±lamadƒ±:', error);
                showTempMessage('‚ùå Kayƒ±t ba≈ülatƒ±lamadƒ±. Manuel butonlarƒ± kullanƒ±n.', 'error');
                showManualControls();
                
                recordBtn.disabled = false;
                recordBtn.textContent = 'üé§ Kaydet';
                recordingIndicator.style.display = 'none';
                isRecording = false;
            }
        }
        
        function analyzeAudio(audioBlob) {
            console.log('Ses analizi ba≈ülatƒ±lƒ±yor...', audioBlob.size, 'bytes');
            
            recordingIndicator.style.display = 'none';
            recordBtn.disabled = false;
            recordBtn.textContent = 'üé§ Kaydet';
            
            // Analiz s√ºrecini sim√ºle et
            showTempMessage('üîç Ses analiz ediliyor...', 'info');
            
            setTimeout(() => {
                // Ger√ßek uygulamada burada ses i≈üleme API'si kullanƒ±lƒ±r
                // Demo i√ßin rastgele sonu√ß √ºretiliyor (%75 ba≈üarƒ± ≈üansƒ±)
                const isCorrect = Math.random() > 0.25;
                
                console.log('Analiz sonucu:', isCorrect ? 'Doƒüru' : 'Yanlƒ±≈ü');
                
                if (isCorrect) {
                    correctAnswers++;
                } else {
                    wrongAnswers++;
                }
                
                showFeedback(isCorrect);
                setTimeout(() => {
                    nextWord();
                }, 2000);
                
            }, 1500);
        }
        
        // Event listeners
        listenBtn.addEventListener('click', () => {
            const wordData = getCurrentWordData();
            speakWord(wordData.word);
        });
        
        recordBtn.addEventListener('click', () => {
            if (!isRecording) {
                startRecording();
            }
        });
        
        // Manuel kontrol butonlarƒ±
        correctBtn.addEventListener('click', () => {
            correctAnswers++;
            showFeedback(true);
            nextWord();
        });
        
        wrongBtn.addEventListener('click', () => {
            wrongAnswers++;
            showFeedback(false);
            nextWord();
        });
        
        // Uygulamayƒ± ba≈ülat
        window.addEventListener('load', () => {
            // Ba≈ülangƒ±√ß ekranƒ±nƒ± g√∂ster
            startScreen.style.display = 'block';
        });
    </script>
</body>
</html>